<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WordBasket Online</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/modern-css-reset@1.4.0/dist/reset.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    :root {
      --wb-orange: #ff9f1c;
      --wb-orange-deep: #ff7a00;
      --wb-red: #ef3b2d;
      --wb-yellow: #ffd447;
      --wb-blue: #2151c8;
      --wb-green: #18b35f;
      --wb-ink: #2a1f1b;
    }
    body {
      min-height: 100vh;
      color: var(--wb-ink);
      background:
        radial-gradient(circle at 10% 0%, rgba(255, 212, 71, .55), transparent 35%),
        radial-gradient(circle at 90% 8%, rgba(239, 59, 45, .2), transparent 35%),
        repeating-linear-gradient(135deg, #ffeab2 0 16px, #ffe29a 16px 32px);
    }
    .app-shell { max-width: 980px; margin: 0 auto; padding: 16px; }
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }
    .app-title {
      font-weight: 900;
      color: var(--wb-red);
      text-shadow: 1px 1px 0 #fff, 2px 2px 0 rgba(33, 81, 200, 0.22);
      margin-bottom: 0;
      font-size: clamp(1.35rem, 4.6vw, 1.9rem);
    }
    .glass-btn {
      background: linear-gradient(135deg, var(--wb-red), var(--wb-orange-deep));
      border: 0;
      color: #fff;
      font-weight: 700;
    }
    .panel {
      background: rgba(255,255,255,0.95);
      border-radius: 18px;
      padding: 14px;
      border: 3px solid rgba(255, 159, 28, 0.38);
      box-shadow: 0 12px 28px rgba(128, 44, 0, .16);
    }
    .nav-tabs .nav-link {
      color: #7a4200;
      font-weight: 700;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }
    .nav-tabs .nav-link.active {
      color: #fff;
      background: linear-gradient(135deg, var(--wb-blue), #3f74f0);
      border-color: transparent;
    }
    .char-card {
      min-width: clamp(60px, 15vw, 96px);
      min-height: clamp(90px, 18vw, 118px);
      border-radius: 16px;
      border: 3px solid #ffd07d;
      background: linear-gradient(160deg, #fffdfa, #fff2d0);
      display: inline-flex;
      justify-content: center;
      align-items: center;
      font-size: 28px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 8px 14px rgba(111, 61, 0, .18);
      transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease;
    }
    .char-card:hover { transform: translateY(-3px); box-shadow: 0 10px 16px rgba(111, 61, 0, .22); }
    .char-card.selected {
      border-color: var(--wb-red);
      transform: translateY(-8px) scale(1.05);
      box-shadow: 0 14px 20px rgba(239, 59, 45, .32);
    }
    .char-card.field { width: 84px; height: 108px; font-size: 42px; margin: 0 auto; min-height: 108px; }
    .char-card.hand-card,
    .char-card.hand-card:hover {
      box-shadow: none;
    }
    .deck-card {
      width: 84px;
      height: 108px;
      border-radius: 12px;
      background: repeating-linear-gradient(45deg,var(--wb-blue),var(--wb-blue) 10px,#3b79f8 10px,#3b79f8 20px);
      margin: 0 auto;
      position: relative;
    }
    .hand-scroll {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: nowrap;
      padding: 8px;
      width: 100%;
      margin: 0;
      overflow-x: auto;
    }
    .small-player { font-size: 0.9rem; }
    #toastBox { position: fixed; right: 12px; bottom: 12px; z-index: 9999; min-width: 220px; }
    #playBtn { min-height: 56px; font-size: 1.06rem; font-weight: 700; }
    #clearOverlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle, rgba(255, 244, 207, .94), rgba(255, 168, 50, .8));
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 12000;
      opacity: 0;
      pointer-events: none;
    }
    #clearOverlay .clear-message {
      text-align: center;
      color: #9e180d;
      text-shadow: 2px 2px 0 #fff;
    }
    #clearOverlay .clear-message h2 { font-weight: 900; font-size: clamp(2rem, 8vw, 4rem); }
    #clearOverlay .clear-message p { font-size: clamp(1rem, 3vw, 1.3rem); font-weight: 700; }
    .confetti-piece {
      position: fixed;
      width: 14px;
      height: 14px;
      border-radius: 3px;
      z-index: 12001;
      pointer-events: none;
    }
    #helpBtn {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      padding: 0;
    }
    .text-link-btn {
      border: 0;
      background: transparent;
      padding: 0;
      text-decoration: underline;
      font-size: .92rem;
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header class="app-header">
    <h1 class="app-title"><i class="fa-solid fa-bolt"></i> ãƒ¯ãƒ¼ãƒ‰ãƒã‚¹ã‚±ãƒƒãƒˆï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³ï¼‰</h1>
    <button id="helpBtn" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#helpModal" aria-label="ãƒ«ãƒ¼ãƒ«èª¬æ˜"><i class="fa-solid fa-circle-question"></i></button>
  </header>

  <section id="lobbyView" class="panel">
    <div class="mb-3">
      <label class="form-label">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å</label>
      <input id="nameInput" class="form-control" maxlength="16" placeholder="ãªã¾ãˆ" value="Player" />
    </div>

    <ul class="nav nav-tabs mb-3" id="roomTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="join-tab" data-bs-toggle="tab" data-bs-target="#joinPane" type="button" role="tab" aria-controls="joinPane" aria-selected="true">ãƒ«ãƒ¼ãƒ ã«å‚åŠ </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="create-tab" data-bs-toggle="tab" data-bs-target="#createPane" type="button" role="tab" aria-controls="createPane" aria-selected="false">ãƒ«ãƒ¼ãƒ ã‚’ä½œæˆ</button>
      </li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane fade show active" id="joinPane" role="tabpanel" aria-labelledby="join-tab" tabindex="0">
        <div class="row g-2 align-items-end">
          <div class="col-sm-7">
            <label class="form-label">4æ¡ãƒ«ãƒ¼ãƒ ID</label>
            <input id="roomInput" class="form-control" maxlength="4" placeholder="0123" />
          </div>
          <div class="col-sm-5">
            <button id="joinRoomBtn" class="btn btn-primary w-100"><i class="fa-solid fa-right-to-bracket"></i> å‚åŠ ã™ã‚‹</button>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="createPane" role="tabpanel" aria-labelledby="create-tab" tabindex="0">
        <div class="d-grid d-sm-flex gap-2 mb-2">
          <button id="createRoomBtn" class="btn glass-btn"><i class="fa-solid fa-plus"></i> æ–°è¦ãƒ«ãƒ¼ãƒ ä½œæˆ</button>
          <button id="copyRoomBtn" class="btn btn-outline-primary d-none"><i class="fa-regular fa-copy"></i> ãƒ«ãƒ¼ãƒ IDã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>
        <div id="createdRoomText" class="text-primary fw-bold"></div>
      </div>
    </div>
  </section>

  <section id="gameView" class="d-none">
    <div class="panel mb-3">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
        <div>
          <div class="small text-muted">ROOM</div>
          <div id="roomLabel" class="h5 mb-0"></div>
        </div>
        <div id="lastPlay" class="small text-muted">ã¾ã æˆåŠŸãƒ—ãƒ¬ã‚¤ã¯ã‚ã‚Šã¾ã›ã‚“</div>
        <div class="d-flex gap-2">
          <button id="leaveBtn" class="btn btn-outline-danger btn-sm"><i class="fa-solid fa-right-from-bracket"></i> é€€å®¤</button>
        </div>
      </div>
      <div id="playersBox" class="mt-2"></div>
    </div>

    <div class="panel mb-3">
      <div class="row text-center align-items-center">
        <div class="col-6">
          <div class="small text-muted mb-1">å±±æœ­</div>
          <div class="deck-card"><span id="deckCountBadge" class="badge text-bg-light position-absolute top-0 start-100 translate-middle"></span></div>
        </div>
        <div class="col-6">
          <div class="small text-muted mb-1">å ´ã®é–‹å§‹æ–‡å­—</div>
          <div id="fieldChar" class="char-card field">?</div>
        </div>
      </div>
      <div class="text-center mt-2">
        <button id="shuffleFieldBtn" class="text-link-btn text-warning"><i class="fa-solid fa-shuffle"></i> å ´ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
      </div>
    </div>

    <div class="panel mb-3">
      <div class="small text-muted mb-2">ã‚ãªãŸã®æ‰‹æœ­ï¼ˆã‚¿ãƒƒãƒ—ã—ã¦é¸æŠï¼‰</div>
      <div id="handBox" class="hand-scroll"></div>
    </div>

    <div class="panel" id="playPanel">
      <div class="small mb-2">é¸æŠä¸­ã‚«ãƒ¼ãƒ‰: <span id="selectedCharLabel" class="fw-bold">æœªé¸æŠ</span></div>
      <button id="playBtn" class="btn btn-success w-100">æ±ºå®šï¼ˆå ´ã«å‡ºã™ï¼‰</button>
      <div class="text-center mt-2">
        <button id="undoBtn" class="text-link-btn text-secondary"><i class="fa-solid fa-rotate-left"></i> å‡ºã—ãŸã‚«ãƒ¼ãƒ‰ã‚’æ‰‹æœ­ã«æˆ»ã™</button>
      </div>
    </div>
  </section>
</div>

<div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="helpModalLabel">ãƒ«ãƒ¼ãƒ«ï¼ˆã‹ã‚“ãŸã‚“ç‰ˆï¼‰</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <ul class="mb-0 ps-3">
          <li>æ‰‹æœ­ã‹ã‚‰1æšã‚’é¸ã³ã€ã€Œæ±ºå®šï¼ˆå ´ã«å‡ºã™ï¼‰ã€ã§å ´ã«å‡ºã—ã¾ã™ã€‚</li>
          <li>å…ˆã«æ‰‹æœ­ã‚’0æšã«ã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå‹åˆ©ã§ã™ã€‚</li>
          <li>ç›´å‰ã®1æ‰‹ã ã‘ã€Œå‡ºã—ãŸã‚«ãƒ¼ãƒ‰ã‚’æ‰‹æœ­ã«æˆ»ã™ã€ã§å–ã‚Šæ¶ˆã›ã¾ã™ã€‚</li>
          <li>è¿·ã£ãŸã‚‰ã€Œå ´ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã€ã§å ´ã®é–‹å§‹æ–‡å­—ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<div id="toastBox"></div>
<div id="clearOverlay">
  <div class="clear-message">
    <h2>ğŸ‰ CLEAR! ğŸ‰</h2>
    <p>æ‰‹æœ­ã‚’ã™ã¹ã¦å‡ºã—åˆ‡ã‚Šã¾ã—ãŸï¼</p>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
<script>
(() => {
  const appBase = location.pathname.replace(/[^/]*$/, '');
  const apiUrl = `${appBase}api.php`;
  const state = {
    roomId: null,
    myPlayerId: null,
    roomState: null,
    selectedEndChar: null,
    selectedDom: null,
    pollTimer: null,
    previousHandCount: null
  };

  function toast(message, tone='danger') {
    const id = 't' + Date.now();
    $('#toastBox').append(`<div id="${id}" class="alert alert-${tone} py-2 px-3 mb-2">${message}</div>`);
    setTimeout(() => $('#' + id).fadeOut(300, () => $('#' + id).remove()), 1800);
  }

  async function api(action, payload = {}) {
    const roomPayload = state.roomId && !payload.roomId ? { ...payload, roomId: state.roomId } : payload;
    const res = await fetch(`${apiUrl}?action=${action}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(roomPayload)
    });
    const data = await res.json();
    if (!res.ok || data.ok === false) throw new Error(data.reason || data.error || 'API_ERROR');
    return data;
  }

  function me() {
    return state.roomState?.players?.find(p => p.playerId === state.myPlayerId);
  }

  function animatePlayToField() {
    if (!state.selectedDom || !$('#fieldChar').length) return;
    const from = state.selectedDom.getBoundingClientRect();
    const to = $('#fieldChar')[0].getBoundingClientRect();
    const clone = $(state.selectedDom).clone().css({
      position: 'fixed', left: from.left, top: from.top, margin: 0, zIndex: 9998
    }).appendTo('body');
    gsap.to(clone[0], {
      x: to.left - from.left,
      y: to.top - from.top,
      scale: 0.85,
      rotation: 5,
      duration: 0.26,
      ease: 'power2.inOut',
      onComplete: () => clone.remove()
    });
    gsap.fromTo('#fieldChar', { scale: 1 }, { scale: 1.1, duration: 0.18, yoyo: true, repeat: 1, ease: 'power1.inOut', delay: 0.08 });
  }

  function animateReject() {
    if (!state.selectedDom) return;
    gsap.fromTo(state.selectedDom, { x: 0 }, { x: 10, duration: 0.05, repeat: 3, yoyo: true });
  }

  function celebrateClear() {
    const overlay = $('#clearOverlay');
    overlay.css({ opacity: 0, pointerEvents: 'none' });
    gsap.to(overlay[0], { opacity: 1, duration: 0.35, ease: 'power1.out' });
    gsap.fromTo('.clear-message', { scale: 0.7, y: 18 }, { scale: 1, y: 0, duration: 0.45, ease: 'back.out(1.5)' });

    const colors = ['#ef3b2d', '#ff9f1c', '#ffd447', '#2151c8', '#18b35f'];
    for (let i = 0; i < 48; i++) {
      const piece = $('<span class="confetti-piece"></span>').css({
        left: `${Math.random() * window.innerWidth}px`,
        top: '-20px',
        backgroundColor: colors[Math.floor(Math.random() * colors.length)]
      }).appendTo('body');
      gsap.to(piece[0], {
        y: window.innerHeight + 40,
        x: (Math.random() - 0.5) * 220,
        rotation: Math.random() * 540,
        duration: 1.6 + Math.random() * 1.2,
        ease: 'power1.in',
        onComplete: () => piece.remove()
      });
    }

    setTimeout(() => {
      gsap.to(overlay[0], { opacity: 0, duration: 0.4, onComplete: () => overlay.css('pointerEvents', 'none') });
    }, 1800);
  }

  function renderPlayers() {
    if (!state.roomState) return;
    const html = state.roomState.players.map(p => {
      const icon = p.connected ? '<span class="text-success">â—</span>' : '<span class="text-secondary">â—</span>';
      const mine = p.playerId === state.myPlayerId ? ' (ã‚ãªãŸ)' : '';
      return `<span class="badge text-bg-light me-1 mb-1 small-player">${icon} ${p.name}${mine} / æ‰‹æœ­:${p.handCount}</span>`;
    }).join('');
    $('#playersBox').html(html);
  }

  function renderHand() {
    const my = me();
    if (!my) return $('#handBox').html('');
    const html = (my.hand || []).map((c, idx) => `<button class="char-card hand-card" data-char="${c}" data-idx="${idx}">${c}</button>`).join('');
    $('#handBox').html(html || '<span class="text-success">æ‰‹æœ­0æšï¼</span>');

    const cards = my.hand || [];
    if (state.selectedEndChar !== null && !cards.includes(state.selectedEndChar)) {
      state.selectedEndChar = null;
      state.selectedDom = null;
      $('#selectedCharLabel').text('æœªé¸æŠ');
    }

    if (state.selectedEndChar !== null) {
      const preserved = $('#handBox .char-card').filter((_, el) => $(el).data('char') === state.selectedEndChar).first();
      if (preserved.length) {
        preserved.addClass('selected');
        state.selectedDom = preserved[0];
      }
    }

    $('#handBox .char-card').on('click', function () {
      $('#handBox .char-card').removeClass('selected');
      $(this).addClass('selected');
      state.selectedEndChar = $(this).data('char');
      state.selectedDom = this;
      $('#selectedCharLabel').text(state.selectedEndChar);
      gsap.fromTo(this, { scale: 0.94 }, { scale: 1.05, duration: 0.14, ease: 'power1.out' });
    });
  }

  function render() {
    const inRoom = !!state.roomState;
    $('#lobbyView').toggleClass('d-none', inRoom);
    $('#gameView').toggleClass('d-none', !inRoom);
    if (!inRoom) return;

    const rs = state.roomState;
    $('#roomLabel').text(rs.roomId);
    $('#fieldChar').text(rs.currentChar || '?');
    $('#deckCountBadge').text(rs.deckCount || 0);
    $('#lastPlay').text(rs.lastPlay ? `${rs.lastPlay.name}: ã€Œ${rs.lastPlay.endChar}ã€ã‚’å ´ã«å‡ºã—ã¾ã—ãŸ` : 'ã¾ã ã‚«ãƒ¼ãƒ‰ã¯å‡ºã•ã‚Œã¦ã„ã¾ã›ã‚“');
    renderPlayers();
    renderHand();

    const my = me();
    const currentHandCount = my?.hand?.length ?? null;
    $('#playPanel').toggleClass('d-none', currentHandCount === 0);
    if (state.previousHandCount !== null && state.previousHandCount > 0 && currentHandCount === 0) {
      celebrateClear();
      toast('ãŠã‚ã§ã¨ã†ï¼ã‚¯ãƒªã‚¢ã§ã™ï¼', 'success');
    }
    state.previousHandCount = currentHandCount;
  }

  function startPolling() {
    if (state.pollTimer) clearInterval(state.pollTimer);
    state.pollTimer = setInterval(async () => {
      if (!state.roomId || !state.myPlayerId) return;
      try {
        const res = await api('get_state', { roomId: state.roomId, playerId: state.myPlayerId });
        state.roomState = res.roomState;
        render();
      } catch (e) {
        toast('çŠ¶æ…‹åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸ', 'warning');
      }
    }, 1000);
  }

  $('#createRoomBtn').on('click', async () => {
    try {
      const res = await api('create_room', { name: $('#nameInput').val() });
      state.roomId = res.roomId;
      state.myPlayerId = res.playerId;
      state.roomState = res.roomState;
      $('#createdRoomText').text(`ä½œæˆæ¸ˆã¿ROOM: ${res.roomId}`);
      $('#roomInput').val(res.roomId);
      $('#copyRoomBtn').removeClass('d-none').data('room', res.roomId);
      location.hash = `#/room/${res.roomId}`;
      startPolling();
      render();
    } catch (e) {
      toast(`ä½œæˆå¤±æ•—: ${e.message}`);
    }
  });

  $('#copyRoomBtn').on('click', function () {
    const room = $(this).data('room');
    navigator.clipboard.writeText(room).then(() => toast('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ', 'success')).catch(() => toast('ã‚³ãƒ”ãƒ¼å¤±æ•—'));
  });

  $('#joinRoomBtn').on('click', async () => {
    const roomId = String($('#roomInput').val() || '').replace(/\D/g, '').padStart(4, '0').slice(-4);
    const name = $('#nameInput').val();
    if (!/^\d{4}$/.test(roomId)) return toast('4æ¡æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
    try {
      const res = await api('join_room', { roomId, name });
      state.roomId = roomId;
      state.myPlayerId = res.playerId;
      state.roomState = res.roomState;
      location.hash = `#/room/${roomId}`;
      startPolling();
      render();
    } catch (e) {
      toast(`å‚åŠ å¤±æ•—: ${e.message}`);
    }
  });

  $('#playBtn').on('click', async () => {
    if (!state.roomState) return;
    if (!state.selectedEndChar) return toast('æ‰‹æœ­ã‚’é¸æŠã—ã¦ãã ã•ã„');
    animatePlayToField();
    try {
      const res = await api('play_request', {
        roomId: state.roomId,
        playerId: state.myPlayerId,
        endChar: state.selectedEndChar
      });
      state.roomState = res.roomState;
      state.selectedEndChar = null;
      state.selectedDom = null;
      $('#selectedCharLabel').text('æœªé¸æŠ');
      toast('ã‚«ãƒ¼ãƒ‰ã‚’å‡ºã—ã¾ã—ãŸï¼', 'success');
    } catch (e) {
      animateReject();
      toast(`ãƒ—ãƒ¬ã‚¤å¤±æ•—: ${e.message}`);
    }
    render();
  });

  $('#undoBtn').on('click', async () => {
    const actionId = state.roomState?.lastAction?.actionId;
    if (!actionId) return toast('æˆ»ã›ã‚‹ç›´è¿‘æ‰‹ãŒã‚ã‚Šã¾ã›ã‚“');
    try {
      const res = await api('undo_request', { roomId: state.roomId, playerId: state.myPlayerId, actionId });
      state.roomState = res.roomState;
      toast('æ‰‹æœ­ã«æˆ»ã—ã¾ã—ãŸ', 'success');
      render();
    } catch (e) {
      toast(`å–ã‚Šæ¶ˆã—ä¸å¯: ${e.message}`);
    }
  });

  $('#shuffleFieldBtn').on('click', async () => {
    if (!state.roomState) return;
    try {
      const res = await api('shuffle_field', { roomId: state.roomId, playerId: state.myPlayerId });
      state.roomState = res.roomState;
      gsap.fromTo('#fieldChar', { rotate: -8, scale: 0.95 }, { rotate: 0, scale: 1, duration: 0.22, ease: 'back.out(1.8)' });
      toast('å ´ã®é–‹å§‹æ–‡å­—ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¾ã—ãŸ', 'success');
      render();
    } catch (e) {
      toast(`ã‚·ãƒ£ãƒƒãƒ•ãƒ«ä¸å¯: ${e.message}`);
    }
  });

  $('#leaveBtn').on('click', async () => {
    if (state.roomId && state.myPlayerId) {
      try { await api('leave_room', { roomId: state.roomId, playerId: state.myPlayerId }); } catch (_) {}
    }
    state.roomId = null;
    state.myPlayerId = null;
    state.roomState = null;
    state.selectedEndChar = null;
    state.selectedDom = null;
    state.previousHandCount = null;
    if (state.pollTimer) clearInterval(state.pollTimer);
    location.hash = '#/';
    render();
  });

  render();
})();
</script>
</body>
</html>
